(function(){"use strict";var e={};e.p="bundles/productbundle/",window?.__sw__?.assetPath&&(e.p=window.__sw__.assetPath+"/bundles/productbundle/"),function(){let{Mixin:e}=Shopware,{Criteria:t}=Shopware.Data;Shopware.Component.register("product-bundle-list",{template:'<sw-page\n    class="sw-generic-custom-entity-list"\n>\n    <template #search-bar>\n        <sw-search-bar\n            key="product_bundle"\n            initial-search-type="product_bundle"\n            :initial-search="term"\n            @search="onSearch"\n        />\n    </template>\n\n    <template #smart-bar-header>\n        <h2 class="sw-generic-custom-entity-list__title">\n            {{ $tc(\'sw-product-bundle.list.textProductBundles\') }}\n\n            <span v-if="!isLoading">\n                ({{ total }})\n            </span>\n        </h2>\n    </template>\n\n    <template #smart-bar-actions>\n        <sw-button\n            class="sw-generic-custom-entity-list__button-add"\n            :router-link="{ name: \'product.bundle.create\' }"\n            variant="primary"\n        >\n            {{ $tc(\'global.default.add\') }}\n        </sw-button>\n    </template>\n\n    <template #language-switch>\n        <sw-language-switch @on-change="onChangeLanguage" />\n    </template>\n\n    <template #content>\n        <div class="sw-generic-custom-entity-list__content">\n             <sw-entity-listing\n                v-if="!isLoading"\n                class="sw-generic-custom-entity-list__content-list"\n                :repository="productBundleRepository"\n                :items="productBundles"\n                :columns="columns"\n                :is-loading="isLoading"\n                :allowEdit="true"\n\n            />\n            <sw-empty-state\n                v-else\n                class="sw-generic-custom-entity-list__content-empty-state"\n                :title="emptyStateTitle"\n                :subline="emptyStateSubline"\n            >\n                <template #actions>\n                    <sw-button\n                        @click="onCreate"\n                        variant="primary"\n                    >\n                        {{ $tc(\'sw-product-bundle.list.textCreateProductBundle\') }}\n                    </sw-button>\n                </template>\n            </sw-empty-state>\n        </div>\n    </template>\n</sw-page>\n',inject:["repositoryFactory"],mixins:[e.getByName("listing")],metaInfo(){return{title:this.$createTitle()}},data(){return{productBundleRepository:this.repositoryFactory.create("product_bundle"),productBundles:[],columns:[{property:"name",label:"Product Bundle Name",routerLink:"product.bundle.detail",allowResize:!0}],isLoading:!1,total:0,criteria:new t(1,25),languageId:Shopware.State.get("context").api.languageId,emptyStateTitle:this.$tc("sw-product-bundle.list.emptyStateTitle"),emptyStateSubline:this.$tc("sw-product-bundle.list.emptyStateSubline")}},methods:{async getList(){this.isLoading=!0,this.criteria.addAssociation("translations");try{console.log("Fetching product bundles...");let e=await this.productBundleRepository.search(this.criteria,Shopware.Context.api);console.log("Product bundles fetched:",e),0===e.length&&console.warn("No product bundles found."),this.total=e.total,this.productBundles=e}catch(e){console.error("Error fetching product bundles:",e.response?.data||e.message),this.productBundles=[]}finally{this.isLoading=!1}},async onChangeLanguage(){await this.loadProductBundle()},onEditItem(e){this.$router.push({name:"product.bundle.detail",params:{id:e.id}})},onCreateNewProductBundle(){this.$router.push({name:"product.bundle.create"})},onSearch(e){this.criteria.setTerm(e),this.getList()}},created(){this.getList()}});let{Mixin:n}=Shopware;Shopware.Component.register("product-bundle-detail",{template:'<sw-page\n    class="sw-generic-custom-entity-detail"\n>\n    <template #smart-bar-header>\n        <h2 class="sw-generic-custom-entity-detail__title">\n         {{ $tc(\'sw-product-bundle.list.textProductBundles\') }}\n        </h2>\n    </template>\n\n    <template #smart-bar-actions>\n        <sw-button-process\n            class="sw-generic-custom-entity-detail__save-action"\n            :is-loading="isLoading"\n            :process-success="isSaveSuccessful"\n            variant="primary"\n            :disabled="isLoading"\n            @update:process-success="saveFinish"\n            @click="saveProductBundle"\n        >\n            {{ $tc(\'global.default.save\') }}\n        </sw-button-process>\n        <template>\n            <sw-confirm-modal\n                v-if="showDeleteConfirmModal"\n                :text="$tc(\'sw-product-bundle.detail.deleteConfirmTitle\')"\n                type="delete"\n                @confirm="confirmDeleteProductBundle"\n                @cancel="showDeleteConfirmModal = false"\n                @close="showDeleteConfirmModal = false"\n            >\n                <p>{{ $tc(\'sw-product-bundle.detail.deleteConfirmMessage\') }}</p>\n            </sw-confirm-modal>\n\n            <sw-button variant="danger" @click="showDeleteModal">\n                {{ $tc(\'global.default.delete\') }}\n            </sw-button>\n        </template>\n\n    </template>\n\n    <template #language-switch>\n        <sw-language-switch @on-change="onChangeLanguage" />\n    </template>\n\n    <template #content>\n        <sw-card-view>\n            <sw-card :title="$tc(\'sw-product-bundle.detail.general\')">\n                <sw-text-field  v-model="productBundleName" @update:value="productBundleName = $event" label="Bundle Name" required  />\n            </sw-card>\n            <sw-card :title="$tc(\'sw-product-bundle.detail.products\')">\n                <div v-for="(product, index) in selectedProducts" :key="index" class="sw-product-bundle-product-row">\n                    <div class="sw-product-bundle-product-name">\n                        <span>{{ product.product.translated.name ?? \'N/A\' }}</span> \n                    </div>\n                    <div class="sw-product-bundle-product-quantity">\n                        <sw-number-field\n                            v-model="product.quantity"\n                            :min="1"\n                            :required="true"\n                        />\n                    </div>\n                    <div class="sw-product-bundle-product-delete">\n                        <sw-button\n                            variant="danger"\n                            @click="deleteProductFromBundle(product.productId)"\n                        >\n                            {{ $tc(\'global.default.delete\') }}\n                        </sw-button>\n                    </div>\n                </div>\n\n                <div class="sw-product-bundle-add-product">\n                   <sw-entity-single-select\n                        v-model="newProduct.productId"\n                        entity="product"\n                        :label="$tc(\'sw-product-bundle.detail.product\')"\n                        :required="true"\n                         @update:value="newProduct.productId = $event"\n                        />\n                    <sw-number-field\n                        v-model="newProduct.quantity"\n                        :label="$tc(\'sw-product-bundle.detail.quantity\')"\n                        :min="1"\n                        @update:value="newProduct.quantity = $event"\n                        :required="true"\n                    />\n                    <sw-button\n                        variant="primary"\n                        @click="addProductToBundle"\n                        :disabled="isProductInBundle(newProduct.productId)"\n                    >\n                        {{ $tc(\'global.default.add\') }}\n                    </sw-button>\n                </div>\n            </sw-card>\n\n        </sw-card-view>\n    </template>\n</sw-page>\n',inject:["repositoryFactory","context"],mixins:[n.getByName("notification")],data(){return{productBundleRepository:this.repositoryFactory.create("product_bundle"),productBundle:null,isLoading:!1,saveSuccess:!1,deleteError:!1,selectedProducts:[],newProduct:{productId:null,quantity:1},showDeleteConfirmModal:!1}},computed:{productBundleName(){return this.productBundle?.name},isProductInBundle(){return e=>this.selectedProducts.some(t=>t.productId===e)}},methods:{async loadProductBundle(){this.isLoading=!0;try{let e=new Shopware.Data.Criteria;e.addAssociation("translations"),e.addAssociation("assignedProducts.product"),e.addAssociation("assignedProducts.product.translations"),this.productBundle=await this.productBundleRepository.get(this.$route.params.id,Shopware.Context.api,e),this.selectedProducts=this.productBundle.assignedProducts.map(e=>({bundleId:e.bundleId,productId:e.product.id,product:e.product,quantity:e.quantity})),console.log("Product bundle:",this.productBundle)}catch(e){console.error("Error fetching product bundle:",e.response?.data||e.message),this.productBundle=null}finally{this.isLoading=!1}},async onChangeLanguage(){await this.loadProductBundle()},async saveProductBundle(){this.isLoading=!0;try{await this.productBundleRepository.save(this.productBundle,this.context),this.saveSuccess=!0,this.$router.push({name:"product.bundle.list"})}catch(e){console.error("Error saving product bundle:",e)}finally{this.isLoading=!1}},showDeleteModal(){this.showDeleteConfirmModal=!0},async confirmDeleteProductBundle(){this.isLoading=!0;try{await this.repositoryFactory.create("product_bundle").delete(this.productBundle.id,this.context),this.$router.push({name:"product.bundle.list"})}catch(e){console.error("Error deleting product bundle:",e)}finally{this.isLoading=!1,this.showDeleteConfirmModal=!1}},async addProductToBundle(){if(this.selectedProducts.find(e=>e.productId===this.newProduct.productId)){this.createNotificationError({message:this.$tc("sw-product-bundle.detail.productExistsError")});return}try{let e=this.repositoryFactory.create("product"),t=this.repositoryFactory.create("product_bundle_assigned_products");if(!await e.get(this.newProduct.productId,Shopware.Context.api)){this.createNotificationError({message:this.$tc("sw-product-bundle.detail.productNotFoundError")});return}let n=t.create(Shopware.Context.api);n.bundleId=this.productBundle.id,n.productId=this.newProduct.productId,n.quantity=this.newProduct.quantity,await t.save(n,Shopware.Context.api),this.newProduct.productId=null,this.newProduct.quantity=1,this.loadProductBundle()}catch(e){console.error("Error adding product to bundle:",e),this.createNotificationError({message:this.$tc("sw-product-bundle.detail.productAddError")})}},async deleteProductFromBundle(e){try{let t=this.repositoryFactory.create("product_bundle_assigned_products"),n=new Shopware.Data.Criteria;n.addFilter(Shopware.Data.Criteria.equals("productId",e)),n.addFilter(Shopware.Data.Criteria.equals("bundleId",this.productBundle.id));let r=await t.search(n,Shopware.Context.api);if(!r.length){this.createNotificationError({message:this.$tc("sw-product-bundle.detail.productNotFoundError")});return}for(let e of r)await t.delete(e.id,Shopware.Context.api);this.loadProductBundle()}catch(e){console.error("Error deleting product from bundle:",e),this.createNotificationError({message:this.$tc("sw-product-bundle.detail.productDeleteError")})}}},created(){this.loadProductBundle()},metaInfo(){return{title:this.$createTitle()}}});let{Mixin:r}=Shopware,{Criteria:o}=Shopware.Data;Shopware.Component.register("product-bundle-create",{template:'{% block sw_product_bundle_create_form %}\n<div class="product-bundle-create-form">\n    \n    <sw-inherit-wrapper\n        v-model:value="productBundle.translations[languageId].name"\n        :has-parent="!!parentProduct.id"\n        :inherited-value="getInheritValue(\'translations\', \'name\')"\n    >\n        <template #content="props">\n            <sw-text-field\n                :map-inheritance="props"\n                :value="props.currentValue"\n                :disabled="props.isInherited || !allowEdit"\n                :label="$tc(\'sw-product-bundle.create.labelTitle\')"\n                :required="isTitleRequired"\n                name="sw-field--bundle-name"\n                :error="productBundleNameError"\n                @update:value="props.updateCurrentValue"\n            />\n        </template>\n    </sw-inherit-wrapper>\n\n    \n    <sw-data-grid\n        :columns="columns"\n        :dataSource="availableProducts"\n        :selectionMode="\'multiple\'"\n        v-model:selection="selectedProducts"\n        :rowKey="product => product.id"\n    >\n        <template #column-actions="{ item }">\n            <sw-button\n                variant="danger"\n                @click="removeProductFromBundle(item)"\n                icon="default-action-delete"\n            >\n                {{ $tc(\'sw-product-bundle.create.removeProduct\') }}\n            </sw-button>\n        </template>\n    </sw-data-grid>\n\n    \n    <div class="product-bundle-create-form__buttons">\n        <sw-button\n            variant="primary"\n            :disabled="saveDisabled"\n            @click="saveBundle"\n        >\n            {{ $tc(\'sw-product-bundle.create.saveButton\') }}\n        </sw-button>\n        <sw-button\n            variant="default"\n            @click="cancel"\n        >\n            {{ $tc(\'sw-product-bundle.create.cancelButton\') }}\n        </sw-button>\n    </div>\n</div>\n{% endblock %}\n',inject:["repositoryFactory"],mixins:[r.getByName("listing")],data(){return{productBundleRepository:this.repositoryFactory.create("product_bundle"),productBundle:null,languageId:Shopware.State.get("context").api.languageId,availableProducts:[],selectedProducts:[],columns:[{property:"name",label:this.$tc("sw-product-bundle.create.productColumnName"),align:"left"},{property:"quantity",label:this.$tc("sw-product-bundle.create.productColumnQuantity"),align:"center"},{property:"actions",label:this.$tc("sw-product-bundle.create.actionsColumn"),align:"center"}],isLoading:!1,saveDisabled:!1,productBundleNameError:null}},computed:{saveDisabled(){return!this.productBundle||this.isLoading||!this.selectedProducts.length}},methods:{async createNewBundle(){this.isLoading=!0;try{this.productBundle=this.productBundleRepository.create(Shopware.Context.api),this.productBundle.translations=this.productBundle.translations||{},this.$set(this.productBundle.translations,this.languageId,{name:""}),await this.fetchAvailableProducts()}catch(e){console.error("Error creating bundle:",e)}finally{this.isLoading=!1}},async fetchAvailableProducts(){let e=new o(1,25),t=await this.productBundleRepository.search(e,Shopware.Context.api);this.availableProducts=t},addProductToBundle(e){this.selectedProducts.includes(e)||this.selectedProducts.push(e)},removeProductFromBundle(e){let t=this.selectedProducts.indexOf(e);-1!==t&&this.selectedProducts.splice(t,1)},async saveBundle(){this.isLoading=!0;try{this.productBundle.products=this.selectedProducts.map(e=>({productId:e.id,quantity:1})),await this.productBundleRepository.save(this.productBundle,Shopware.Context.api),this.$router.push({name:"product.bundle.list"})}catch(e){console.error("Error saving bundle:",e)}finally{this.isLoading=!1}},cancel(){this.$router.push({name:"product.bundle.list"})}},created(){this.createNewBundle()}});var d=JSON.parse('{"product-bundle":{"general":{"mainMenuItemGeneral":"My custom module","descriptionTextModule":"Manage this custom module here"}}}'),a=JSON.parse('{"sw-product-bundle":{"general":{"mainMenuItemList":"Product bundles","mainMenuItemGeneral":"Product bundles","placeholderSearchBar":"Search bundles...","descriptionTextModule":"Manage bunldes here."},"list":{"textReviewOverview":"Product Bundle","columnProduct":"Product","columnPoints":"Stars","columnUser":"Customer","columnStatus":"Approved","columnCreatedAt":"Created at","columnComment":"Commented on","columnTitle":"Bundle title","columnName":"Name","placeholderSearchBar":"Search product bundles...","textProductBundles":"Product Bundles","messageEmpty":"No product bundles yet","messageEmptySubline":"Manage product bundles here","titleSidebarItemRefresh":"Refresh","buttonAddProperty":"Add Product bundle","textProperties":"Product Bundles","buttonAddBundle":"Add product bundle"},"detail":{"textHeadline":"Product Bundle","cardTitleReviewInfo":"Product Bundle","cardTitleReviewProperties":"Properties","labelTitle":"Title","labelPoints":"Points","labelUser":"User","labelSalesChannel":"Sales Channel","labelCreatedAt":"Created at","labelProduct":"Product","labelEmail":"Email address","labelLanguage":"Language","labelPositive":"Positive votes","labelNegative":"Negative votes","labelStatus":"Approved","labelContent":"Content","labelComment":"Comment","labelCustomer":"Customer","titleCardComment":"Comment","placeholderComment":"Enter comment...","review1PointRatingText":"Unsatisfactory","review2PointRatingText":"Acceptable","review3PointRatingText":"Good","review4PointRatingText":"Very good","review5PointRatingText":"Excellent","quantity":"Quantity","products":"Products","general":"Bundle","selectProductPlaceholder":"Select product","selectProduct":"Product","productExistsError":"This product is already in the bundle.","product":"Product","deleteConfirmTitle":"Delete Bundle?","deleteConfirmMessage":"Are you sure you want to delete this product bundle? This action cannot be undone."}},"sw-privileges":{"permissions":{"review":{"label":"Product Bundles"}}}}');Shopware.Module.register("product-bundle",{type:"plugin",name:"Product Bundle",title:"sw-product-bundle.general.mainMenuItemGeneral",description:"sw-property.general.descriptionTextModule",snippets:{"de-DE":d,"en-GB":a},routes:{list:{component:"product-bundle-list",path:"list"},detail:{component:"product-bundle-detail",path:"detail/:id",meta:{parentPath:"product.bundle.list"}},create:{component:"product-bundle-create",path:"create",meta:{parentPath:"product.bundle.list"}}},navigation:[{id:"product-bundle-plugin",label:"sw-product-bundle.general.mainMenuItemGeneral",color:"#ff3d58",path:"product.bundle.list",parent:"sw-catalogue",icon:"default-shopping-paper-bag-product",position:100}]})}()})();